
# å‰è¨€

æœ€æ—©çœ‹åˆ°è¿™ä¸ªåšå®¢çš„æºç çš„æ—¶å€™æ˜¯é€šè¿‡Bç«™upä¸»-[**CodeSheep**](https://space.bilibili.com/384068749)çš„ä¸€ä¸ªè§†é¢‘ï¼š[Javaä¼ä¸šçº§å¼€æºé¡¹ç›®æ¨èï¼Œå¸®åŠ©å¤§å®¶ä»å­¦ä¹ èµ°å‘å®è·µ](https://www.bilibili.com/video/av49644128)ï¼Œå¥ˆä½•å½“æ—¶è‡ªå·±çŸ¥è¯†æœ‰é™ï¼Œæ²¡æœ‰ä»”ç»†çš„é˜…è¯»æºç ã€‚è¿‘æ—¥Haloä¹Ÿæ¨å‡ºäº†æ­£å¼ç‰ˆï¼Œæˆ‘ä¹Ÿå°±æŠ±ç€å­¦ä¹ çš„å¿ƒæ€æ‹œè¯»ä¸€ä¸‹ã€‚

é¦–å…ˆæ‰“å¼€å·¥ç¨‹ï¼Œçœ‹åˆ°æ•´ä¸ªå·¥ç¨‹æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ˜æ˜¾çš„å˜åŒ–ï¼š

- é…ç½®æ–‡ä»¶ç”±propertieså˜ä¸ºyaml

å¯ä»¥æ˜æ˜¾çš„çœ‹åˆ°ï¼Œåœ¨å¤„ç†å±‚çº§å…³ç³»çš„æ—¶å€™ï¼Œpropertieséœ€è¦ä½¿ç”¨å¤§é‡çš„è·¯å¾„æ¥æè¿°å±‚çº§ï¼ˆæˆ–è€…å±æ€§ï¼‰ï¼Œæ¯”å¦‚environments.dev.urlå’Œenvironments.dev.nameã€‚å…¶æ¬¡ï¼Œå¯¹äºè¾ƒä¸ºå¤æ‚çš„ç»“æ„ï¼Œæ¯”å¦‚æ•°ç»„ï¼ˆmy.serversï¼‰ï¼Œå†™èµ·æ¥æ›´ä¸ºå¤æ‚ã€‚è€Œå¯¹åº”çš„YAMLæ ¼å¼æ–‡ä»¶å°±ç®€å•å¾ˆå¤šï¼š

- æ„å»ºå·¥å…·ç”±Meavnå˜ä¸ºGradle

å› ä¸ºæ­¤å‰æœ‰è¿‡Androidçš„å¼€å‘ç»éªŒï¼Œæ‰€ä»¥è¿™ä¸€æ”¹å˜å¯¹æˆ‘çš„å½±å“å¹¶ä¸å¤§ğŸ˜„ã€‚Gradleé€æ¸æ›¿ä»£meavnåº”è¯¥æ˜¯ç›®å‰çš„è¶‹åŠ¿ï¼Œç”±äºç›®å‰å¤§éƒ¨åˆ†æ•™å­¦å’Œä¼ä¸šé‡‡ç”¨çš„è¿˜æ˜¯ä»¥Meavnä¸ºä¸»ï¼Œæ‰€ä»¥æ­¤å‰æˆ‘ä¹Ÿæœªæ›¾å°è¯•è¿‡é‡‡ç”¨Gradleæ„å»ºé¡¹ç›®ã€‚ç”±æ­¤çœ‹å‡ºHaloè¿˜æ˜¯å¾ˆFashionçš„ğŸ‘ã€‚

# Application

é¦–å…ˆæ‰“å¼€``Application.java``æ–‡ä»¶ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆå­¦ä¹ çš„åœ°æ–¹ğŸ¤¤ã€‚

```java
@SpringBootApplication
@EnableJpaAuditing
@EnableScheduling
@EnableAsync
@EnableJpaRepositories(basePackages = "run.halo.app.repository", repositoryBaseClass = BaseRepositoryImpl.class)
public class Application extends SpringBootServletInitializer {

    private static ConfigurableApplicationContext CONTEXT;

    public static void main(String[] args) {
        // Customize the spring config location
        System.setProperty("spring.config.additional-location", "file:${user.home}/.halo/,file:${user.home}/halo-dev/");

        // Run application
        CONTEXT = SpringApplication.run(Application.class, args);

    }

    /**
     * Restart Application.
     */
    public static void restart() {
        ApplicationArguments args = CONTEXT.getBean(ApplicationArguments.class);

        Thread thread = new Thread(() -> {
            CONTEXT.close();
            CONTEXT = SpringApplication.run(Application.class, args.getSourceArgs());
        });

        thread.setDaemon(false);
        thread.start();
    }

    @Override
    protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {
        System.setProperty("spring.config.additional-location", "file:${user.home}/.halo/,file:${user.home}/halo-dev/");
        return application.sources(Application.class);
    }
}

```

# æ³¨è§£

å¤„å¤„ç•™å¿ƒçš†å­¦é—®ï¼Œè¯¥ç±»ä¸€å…±æ‰“ä¸Šäº†5ä¸ªæ³¨è§£ï¼š

```java
@SpringBootApplication
@EnableJpaAuditing
@EnableScheduling
@EnableAsync
@EnableJpaRepositories(basePackages = "run.halo.app.repository", repositoryBaseClass = BaseRepositoryImpl.class)
```

## @SpringBootApplication

@SpringBootApplication = (é»˜è®¤å±æ€§)@Configuration + @EnableAutoConfiguration + @ComponentScan

è¿™ä¸ªæ³¨è§£å¤§å®¶åº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰

## @EnableJpaAuditing

å®¡è®¡åŠŸèƒ½ï¼š[https://blog.csdn.net/niceyoo/article/details/90452669](https://blog.csdn.net/niceyoo/article/details/90452669)

ä½†æ˜¯å®¡è®¡åŠŸèƒ½åœ¨ç°åœ¨çš„`Halo`ä¸­ä¸å†ä½¿ç”¨ï¼Œæ‰€ä»¥æ”¹æ³¨è§£å¯ä»¥åˆ é™¤ã€‚

## @EnableScheduling

å®šæ—¶ä»»åŠ¡ï¼š[https://www.jianshu.com/p/9d18039c0f08](https://www.jianshu.com/p/9d18039c0f08)

ä½†æ˜¯å®šæ—¶ä»»åŠ¡åŠŸèƒ½åœ¨ç°åœ¨çš„`Halo`ä¸­ä¹Ÿä¸å†ä½¿ç”¨ï¼Œæ‰€ä»¥æ”¹æ³¨è§£å¯ä»¥åˆ é™¤ã€‚

å·²å‘ä½œè€…æ±‚è¯:

![](./img/01-01.png)

## @EnableAsync

å¼€å¯å¤šçº¿ç¨‹ã€å¼‚æ­¥ä»»åŠ¡ï¼š[https://blog.csdn.net/hy_coming/article/details/93885115](https://blog.csdn.net/hy_coming/article/details/93885115)

Haloä¸ºè®¸å¤šçš„`EventListener`éƒ½å¼€å¯äº†å¼‚æ­¥æ–¹æ³•ï¼š

```java
    @Async
    @EventListener
    public void handleCommentNewEvent(CommentNewEvent newEvent) {
        Boolean newCommentNotice = optionService.getByPropertyOrDefault(CommentProperties.NEW_NOTICE, Boolean.class, false);

        if (!newCommentNotice) {
            // Skip mailing
            return;
        }
        ...
```

## @EnableJpaRepositories

ä¸»è¦æ˜¯é…ç½®`repositoryBaseClass`ï¼š[https://www.cnblogs.com/blog5277/p/10661441.html](https://www.cnblogs.com/blog5277/p/10661441.html)

å®ç°Repositoriesçš„è¿›ä¸€æ­¥æŠ½è±¡ï¼Œå…·ä½“çš„åˆ†æï¼Œç­‰åˆ°Repositoriesç« èŠ‚ã€‚

# ç»§æ‰¿

ç»§æ‰¿äº†`SpringBootServletInitializer`ï¼Œå­—é¢æ„æ€å°±æ˜¯Servletçš„åˆå§‹åŒ–ï¼Œä½†æ˜¯Spring Booté»˜è®¤æ˜¯ä¸æ”¯æŒServletçš„ï¼Œä¸ºäº†æ–¹ä¾¿ç”¨æˆ·æ‰“åŒ…æˆwaråŒ…è€Œç»§æ‰¿`SpringBootServletInitializer`ï¼Œä»è€Œå®ç°`configure`æ–¹æ³•ã€‚

```java
@Override
protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {
    System.setProperty("spring.config.additional-location", "file:${user.home}/.halo/,file:${user.home}/halo-dev/");
    return application.sources(Application.class);
}
```

# æ–¹æ³•

## é‡å¯

```java
/**
 * Restart Application.
 */
public static void restart() {
    ApplicationArguments args = CONTEXT.getBean(ApplicationArguments.class);

    Thread thread = new Thread(() -> {
        CONTEXT.close();
        CONTEXT = SpringApplication.run(Application.class, args.getSourceArgs());
    });

    thread.setDaemon(false);
    thread.start();
}
```

**ä¸åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œæ˜¯å¦å¯è¡Œï¼Ÿ**

ä¸å¯è¡Œï¼ŒCONTEXT.close()æ‰§è¡Œåï¼Œç¨‹åºä¾¿ç»“æŸ;

**æ–°çº¿ç¨‹ä¸è®¾ç½®setDaemon(false)æ˜¯å¦å¯è¡Œï¼Ÿçº¿ç¨‹æœ¬èº«ä¾¿æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Ÿ**

ä¸è¡Œï¼Œçº¿ç¨‹ç±»çš„initæ–¹æ³•ä¸­æœ‰ä¸€å¥ä»£ç  `this.daemon = parent.isDaemon(); `åº”è¯¥æ˜¯å½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ daemon ç»§æ‰¿è‡ªçˆ¶çº¿ç¨‹ã€‚ ä½ åœ¨Mainå‡½æ•°ä¸­åˆ›å»ºçº¿ç¨‹ï¼Œé‚£ä¹ˆçˆ¶çº¿ç¨‹å°±æ˜¯ Main ä¸»çº¿ç¨‹ã€‚ ä½ åœ¨GetMappingä¸­åˆ›å»ºçº¿ç¨‹ï¼Œé‚£ä¹ˆçˆ¶çº¿ç¨‹æ˜¯ å¤„ç†è¯·æ±‚çš„çº¿ç¨‹æ±  ä¸­çš„çº¿ç¨‹ã€‚ï¼ˆå¯èƒ½æ˜¯çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œå°±æ˜¯ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥ã€‚å®ƒåˆ›å»ºçš„çº¿ç¨‹ã€‚é»˜è®¤ä¹Ÿæ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚ï¼‰

å‚è€ƒé˜…è¯»ï¼š

[https://segmentfault.com/a/1190000018858017](https://segmentfault.com/a/1190000018858017)

[http://www.spring4all.com/article/1830](http://www.spring4all.com/article/1830)

[https://springboot.io/t/topic/1917](https://springboot.io/t/topic/1917)

# ç»†èŠ‚

**System.setProperty("spring.config.additional-location", "...");**

å¼€å‘è€…ç»™äº†ä»¥ä¸‹æ³¨é‡Šï¼š`Customize the spring config location`ï¼ˆå®šåˆ¶springé…ç½®æ–‡ä»¶çš„ä½ç½®ï¼‰

å­˜åœ¨ä»¥ä¸‹ä¸‰ä¸ªç–‘é—®ï¼š

1ã€System.setPropertyæœ‰ä½•ç”¨ï¼Ÿ

setProperty (String prop, String value); 

- è®¾ç½®æŒ‡å®šé”®å¯¹å€¼çš„ç³»ç»Ÿå±æ€§ï¼Œå…¶ä¸­propï¼šç³»ç»Ÿå±æ€§çš„åç§°ï¼Œvalueï¼šç³»ç»Ÿå±æ€§çš„å€¼ã€‚æ³¨ï¼šè¿™é‡Œçš„systemï¼Œç³»ç»ŸæŒ‡çš„æ˜¯ JRE (runtime)systemï¼Œä¸æ˜¯æŒ‡ OSã€‚ 
- System.setPropertyç›¸å½“äºä¸€ä¸ªé™æ€å˜é‡ï¼Œå­˜åœ¨å†…å­˜é‡Œé¢ï¼Œå¯ä»¥åœ¨é¡¹ç›®çš„ä»»ä½•ä¸€ä¸ªåœ°æ–¹ï¼Œé€šè¿‡System.getProperty("å˜é‡")æ¥è·å¾—

2ã€ä¸ºä½•è¦è®¾å®šè¿™ä¸ªå˜é‡ï¼Ÿ

åŠ è½½å¤–éƒ¨é…ç½®æ–‡ä»¶ã€‚æ‰“åŒ…jarè¿è¡Œä¹Ÿä¸æ–¹ä¾¿ä¿®æ”¹jarå†…éƒ¨æ•°æ®ï¼Œé€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡spring.config.locationã€‚å› ä¸ºåšå®¢ä¸­ä¹Ÿæœ‰å¾ˆå¤šé…ç½®é€‰é¡¹ï¼Œæ‰€ä»¥çŒœæƒ³éœ€è¦ä»å¤–éƒ¨è¯»å–æŸäº›ä¼šæ”¹å˜çš„é…ç½®ï¼Œéœ€è¦ç»§ç»­é˜…è¯»æºç éªŒè¯çŒœæƒ³ã€‚

3ã€${user.home}ä»ä½•è€Œæ¥ï¼Ÿ

å¦‚å‰æ‰€ç¤ºuser.homeåº”è¯¥æ˜¯ä¸€ä¸ªé™æ€å˜é‡ï¼Œå°è¯•æ‰“å°ï¼š

```java
System.out.println(System.getProperty("user.home"));
//æ‰“å°å‡ºï¼šC:\Users\74472 éªŒè¯çŒœæƒ³æˆåŠŸ
```


| å˜é‡ | å«ä¹‰ |
| ---- | ---- |
| java.version | Java è¿è¡Œæ—¶ç¯å¢ƒç‰ˆæœ¬ |
| java.vendor | Java è¿è¡Œæ—¶ç¯å¢ƒä¾›åº”å•†|
|java.vendor.url|Java ä¾›åº”å•†çš„ URL|
|java.home|Java å®‰è£…ç›®å½•|
|java.vm.specification.version|Java è™šæ‹Ÿæœºè§„èŒƒç‰ˆæœ¬|
|java.vm.specification.vendor|Java è™šæ‹Ÿæœºè§„èŒƒä¾›åº”å•†|
|java.vm.specification.name|Java è™šæ‹Ÿæœºè§„èŒƒåç§°|
|java.vm.version|Java è™šæ‹Ÿæœºå®ç°ç‰ˆæœ¬|
|java.vm.vendor|Java è™šæ‹Ÿæœºå®ç°ä¾›åº”å•†|
|java.vm.name|Java è™šæ‹Ÿæœºå®ç°åç§°|
|java.specification.version|Java è¿è¡Œæ—¶ç¯å¢ƒè§„èŒƒç‰ˆæœ¬|
|java.specification.vendor|Java è¿è¡Œæ—¶ç¯å¢ƒè§„èŒƒä¾›åº”å•†|
|java.specification.name|Java è¿è¡Œæ—¶ç¯å¢ƒè§„èŒƒåç§°|
|java.class.version|Java ç±»æ ¼å¼ç‰ˆæœ¬å·|
|java.class.path|Java ç±»è·¯å¾„|
|java.library.path|åŠ è½½åº“æ—¶æœç´¢çš„è·¯å¾„åˆ—è¡¨|
|java.io.tmpdir|é»˜è®¤çš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„|
|java.compiler|è¦ä½¿ç”¨çš„ JIT ç¼–è¯‘å™¨çš„åç§°|
|java.ext.dirs|ä¸€ä¸ªæˆ–å¤šä¸ªæ‰©å±•ç›®å½•çš„è·¯å¾„|
|os.name|æ“ä½œç³»ç»Ÿçš„åç§°|
|os.arch|æ“ä½œç³»ç»Ÿçš„æ¶æ„|
|os.version|æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬|
|file.separator|æ–‡ä»¶åˆ†éš”ç¬¦ï¼ˆåœ¨ UNIX ç³»ç»Ÿä¸­æ˜¯â€œ/â€ï¼‰|
|path.separator|è·¯å¾„åˆ†éš”ç¬¦ï¼ˆåœ¨ UNIX ç³»ç»Ÿä¸­æ˜¯â€œ:â€ï¼‰|
|line.separator|è¡Œåˆ†éš”ç¬¦ï¼ˆåœ¨ UNIX ç³»ç»Ÿä¸­æ˜¯â€œ/nâ€ï¼‰|
|user.name|ç”¨æˆ·çš„è´¦æˆ·åç§°|
|user.home|ç”¨æˆ·çš„ä¸»ç›®å½•|
|user.dir|ç”¨æˆ·çš„å½“å‰å·¥ä½œç›®å½•|

# æ¼”ç¤ºä»£ç 

ä»£ç ä¸‹è½½ : [demo-01](notes/æºç é˜…è¯»/Halo/code/demo-01.zip ':ignore') 

