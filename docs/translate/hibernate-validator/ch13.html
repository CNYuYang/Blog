<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>Annotation Processor</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="validator-annotation-processor">Annotation Processor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Have you ever caught yourself by unintentionally doing things like</p>
</div>
<div class="ulist">
<ul>
<li>
<p>specifying constraint annotations at unsupported data types (e.g. by annotating a String with <code>@Past</code>)</p>
</li>
<li>
<p>annotating the setter of a JavaBeans property (instead of the getter method)</p>
</li>
<li>
<p>annotating static fields/methods with constraint annotations (which is not supported)?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then the Hibernate Validator Annotation Processor is the right thing for you. It helps preventing
such mistakes by plugging into the build process and raising compilation errors whenever constraint
annotations are incorrectly used.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can find the Hibernate Validator Annotation Processor as part of the distribution bundle on
<a href="http://sourceforge.net/projects/hibernate/files/hibernate-validator">Sourceforge</a> or in the
usual Maven repositories such as Maven Central under the GAV
<code>org.hibernate.validator:hibernate-validator-annotation-processor:{hvVersion}</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="validator-annotationprocessor-prerequisites">Prerequisites</h3>
<div class="paragraph">
<p>The Hibernate Validator Annotation Processor is based on the "Pluggable Annotation Processing API"
as defined by <a href="http://jcp.org/en/jsr/detail?id=269">JSR 269</a> which is part of the Java
Platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="validator-annotationprocessor-features">Features</h3>
<div class="paragraph">
<p>As of Hibernate Validator {hvVersion} the Hibernate Validator Annotation Processor checks that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>constraint annotations are allowed for the type of the annotated element</p>
</li>
<li>
<p>only non-static fields or methods are annotated with constraint annotations</p>
</li>
<li>
<p>only non-primitive fields or methods are annotated with <code>@Valid</code></p>
</li>
<li>
<p>only such methods are annotated with constraint annotations which are valid JavaBeans
getter methods (optionally, see below)</p>
</li>
<li>
<p>only such annotation types are annotated with constraint annotations which are constraint
annotations themselves</p>
</li>
<li>
<p>definition of dynamic default group sequence with <code>@GroupSequenceProvider</code> is valid</p>
</li>
<li>
<p>annotation parameter values are meaningful and valid</p>
</li>
<li>
<p>method parameter constraints in inheritance hierarchies respect the inheritance rules</p>
</li>
<li>
<p>method return value constraints in inheritance hierarchies respect the inheritance rules</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="validator-annotationprocessor-options">Options</h3>
<div class="paragraph">
<p>The behavior of the Hibernate Validator Annotation Processor can be controlled using the following
{javaTechnotesBaseUrl}/tools/windows/javac.html#BHCHACIB[processor options]:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>diagnosticKind</code></dt>
<dd>
<p>Controls how constraint problems are reported. Must be the
string representation of one of the values from the enum <code>javax.tools.Diagnostic.Kind</code>,
e.g. <code>WARNING</code>. A value of <code>ERROR</code> will cause compilation to halt whenever the AP detects
a constraint problem. Defaults to <code>ERROR</code>.</p>
</dd>
<dt class="hdlist1"><code>methodConstraintsSupported</code></dt>
<dd>
<p>Controls whether constraints are allowed at methods of any
kind. Must be set to <code>true</code> when working with method level constraints as supported by
Hibernate Validator. Can be set to <code>false</code> to allow constraints only at
JavaBeans getter methods as defined by the Jakarta Bean Validation API. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>verbose</code></dt>
<dd>
<p>Controls whether detailed processing information shall be
displayed or not, useful for debugging purposes. Must be either
<code>true</code> or <code>false</code>. Defaults to <code>false</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="validator-annotationprocessor-usage">Using the Annotation Processor</h3>
<div class="paragraph">
<p>This section shows in detail how to integrate the Hibernate Validator Annotation Processor into
command line builds (Maven, Ant, javac) as well as IDE-based builds (Eclipse, IntelliJ IDEA,
NetBeans).</p>
</div>
<div class="sect3">
<h4 id="validator-annotationprocessor-commandline">Command line builds</h4>
<div class="sect4">
<h5 id="validator-annotationprocessor-maven">Maven</h5>
<div class="paragraph">
<p>For using the Hibernate Validator annotation processor with Maven, set it up via the <code>annotationProcessorPaths</code> option like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Using the HV Annotation Processor with Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-XML" data-lang="XML">&lt;project&gt;
    [...]
    &lt;build&gt;
        [...]
        &lt;plugins&gt;
            [...]
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.6.1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.8&lt;/source&gt;
                    &lt;target&gt;1.8&lt;/target&gt;
                    &lt;annotationProcessorPaths&gt;
                        &lt;path&gt;
                            &lt;groupId&gt;org.hibernate.validator&lt;/groupId&gt;
                            &lt;artifactId&gt;hibernate-validator-annotation-processor&lt;/artifactId&gt;
                            &lt;version&gt;{hvVersion}&lt;/version&gt;
                        &lt;/path&gt;
                    &lt;/annotationProcessorPaths&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            [...]
        &lt;/plugins&gt;
        [...]
    &lt;/build&gt;
    [...]
&lt;/project&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="validator-annotationprocessor-gradle">Gradle</h5>
<div class="paragraph">
<p>When using <a href="https://gradle.org">Gradle</a> it is enough to reference the annotation processor as an <code>annotationProcessor</code> dependency.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Using the annotation processor with Gradle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">dependencies {
	annotationProcessor group: 'org.hibernate.validator', name: 'hibernate-validator-annotation-processor', version: '{hvVersion}'

	// any other dependencies ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="validator-annotationprocessor-ant">Apache Ant</h5>
<div class="paragraph">
<p>Similar to directly working with javac, the annotation processor can be added as as compiler
argument when invoking the <a href="http://ant.apache.org/manual/CoreTasks/javac.html">javac task</a>
for <a href="http://ant.apache.org/">Apache Ant</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Using the annotation processor with Ant</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-XML" data-lang="XML">&lt;javac srcdir="src/main"
       destdir="build/classes"
       classpath="/path/to/validation-api-{bvVersion}.jar"&gt;
       &lt;compilerarg value="-processorpath" /&gt;
       &lt;compilerarg value="/path/to/hibernate-validator-annotation-processor-{hvVersion}.jar"/&gt;
&lt;/javac&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="validator-annotationprocessor-javac">javac</h5>
<div class="paragraph">
<p>When compiling on the command line using
{javaTechnotesBaseUrl}/guides/javac/index.html[javac], specify the JAR
<em>hibernate-validator-annotation-processor-{hvVersion}.jar</em> using the "processorpath" option as shown in
the following listing. The processor will be detected automatically by the compiler and invoked
during compilation.</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Using the annotation processor with javac</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>javac src/main/java/org/hibernate/validator/ap/demo/Car.java \
   -cp /path/to/validation-api-{bvVersion}.jar \
   -processorpath /path/to/hibernate-validator-annotation-processor-{hvVersion}.jar</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="validator-annotationprocessor-ide">IDE builds</h4>
<div class="sect4">
<h5 id="_eclipse">Eclipse</h5>
<div class="paragraph">
<p>The annotation processor will automatically be set up for Maven projects configured as described above,
provided you have the <a href="https://www.eclipse.org/m2e/">M2E Eclipse plug-in</a> installed.</p>
</div>
<div class="paragraph">
<p>For plain Eclipse projects follow these steps to set up the annotation processor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Right-click your project, choose "Properties"</p>
</li>
<li>
<p>Go to "Java Compiler" and make sure, that "Compiler compliance level" is set to "1.8".
Otherwise the processor won&#8217;t be activated</p>
</li>
<li>
<p>Go to "Java Compiler - Annotation Processing" and choose "Enable annotation processing"</p>
</li>
<li>
<p>Go to "Java Compiler - Annotation Processing - Factory Path" and add the JAR
hibernate-validator-annotation-processor-{hvVersion}.jar</p>
</li>
<li>
<p>Confirm the workspace rebuild</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You now should see any annotation problems as regular error markers within the editor and in the
"Problem" view:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="annotation_processor_eclipse.png" alt="annotation processor eclipse">
</div>
</div>
</div>
<div class="sect4">
<h5 id="validator-annotationprocessor-idea">IntelliJ IDEA</h5>
<div class="paragraph">
<p>The following steps must be followed to use the annotation processor within
<a href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a> (version 9 and above):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to "File", then "Settings",</p>
</li>
<li>
<p>Expand the node "Compiler", then "Annotation Processors"</p>
</li>
<li>
<p>Choose "Enable annotation processing" and enter the following as "Processor path":
/path/to/hibernate-validator-annotation-processor-{hvVersion}.jar</p>
</li>
<li>
<p>Add the processor&#8217;s fully qualified name org.hibernate.validator.ap.ConstraintValidationProcessor
to the "Annotation Processors" list</p>
</li>
<li>
<p>If applicable add you module to the "Processed Modules" list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Rebuilding your project then should show any erroneous constraint annotations:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="annotation_processor_intellij.png" alt="annotation processor intellij">
</div>
</div>
</div>
<div class="sect4">
<h5 id="validator-annotationprocessor-netbeans">NetBeans</h5>
<div class="paragraph">
<p>The <a href="http://www.netbeans.org/">NetBeans</a> IDE supports using
annotation processors within the IDE build. To do so, do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Right-click your project, choose "Properties"</p>
</li>
<li>
<p>Go to "Libraries", tab "Processor", and add the JAR hibernate-validator-annotation-processor-{hvVersion}.jar</p>
</li>
<li>
<p>Go to "Build - Compiling", select "Enable Annotation Processing" and "Enable Annotation Processing
in Editor". Add the annotation processor by specifying its fully qualified name
org.hibernate.validator.ap.ConstraintValidationProcessor</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any constraint annotation problems will then be marked directly within the editor:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="annotation_processor_netbeans.png" alt="annotation processor netbeans">
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="validator-annotationprocessor-known-issues">Known issues</h3>
<div class="paragraph">
<p>The following known issues exist as of July 2017:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Container element constraints are not supported for now.</p>
</li>
<li>
<p>Constraints applied to a container but in reality applied to the container elements (be it via
the <code>Unwrapping.Unwrap</code> payload or via a value extractor marked with <code>@UnwrapByDefault</code>) are not supported
correctly.</p>
</li>
<li>
<p><a href="https://hibernate.atlassian.net/browse/HV-308">HV-308</a>: Additional validators
registered for a constraint
<a href="http://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#chapter-xml-configuration">using XML</a> are
not evaluated by the annotation processor.</p>
</li>
<li>
<p>Sometimes custom constraints can&#8217;t be
<a href="https://hibernate.atlassian.net/browse/HV-293">properly evaluated</a> when
using the processor within Eclipse. Cleaning the project can help in these situations. This seems to
be an issue with the Eclipse JSR 269 API implementation, but further investigation is required here.</p>
</li>
<li>
<p>When using the processor within Eclipse, the check of dynamic default group sequence definitions
doesn&#8217;t work. After further investigation, it seems to be an issue with the Eclipse JSR 269 API
implementation.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-03-19 19:50:05 +0800
</div>
</div>
</body>
</html>