<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>Configuring via XML</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="chapter-xml-configuration">Configuring via XML</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far we have used the default configuration source for Jakarta Bean Validation, namely annotations.
However, there also exist two kinds of XML descriptors allowing configuration via XML. The first
descriptor describes general Jakarta Bean Validation behaviour and is provided as <em>META-INF/validation.xml</em>.
The second one describes constraint declarations and closely matches the constraint declaration
approach via annotations. Let&#8217;s have a look at these two document types.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The XSD files are available on the <a href="https://jakarta.ee/xml/ns/validation/" class="bare">https://jakarta.ee/xml/ns/validation/</a> page.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="section-configuration-validation-xml">Configuring the validator factory in <em>validation.xml</em></h3>
<div class="paragraph">
<p>The key to enable XML configuration for Hibernate Validator is the file <em>META-INF/validation.xml</em>.
If this file exists on the classpath its configuration will be applied when the <code>ValidatorFactory</code>
gets created. <a href="#image-validation-configuration">Validation configuration schema</a> shows a model view of the XML schema to which
<em>validation.xml</em> has to adhere.</p>
</div>
<div id="image-validation-configuration" class="imageblock">
<div class="content">
<img src="validation-configuration-2.0.png" alt="validation-configuration-2.0.xsd">
</div>
<div class="title">Figure 1. Validation configuration schema</div>
</div>
<div class="paragraph">
<p><a href="#example-validation-xml"><code>validation.xml</code></a>
shows the several configuration options of <em>validation.xml</em>. All settings are optional and the same
configuration options are also available programmatically through <code>jakarta.validation.Configuration</code>. In
fact, the XML configuration will be overridden by values explicitly specified via the programmatic
API. It is even possible to ignore the XML configuration completely via
<code>Configuration#ignoreXmlConfiguration()</code>. See also <a href="#section-configuring-validator-factory">[section-configuring-validator-factory]</a>.</p>
</div>
<div id="example-validation-xml" class="exampleblock">
<div class="title">Example 1. <code>validation.xml</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-XML" data-lang="XML">link:{resourcesdir}/org/hibernate/validator/referenceguide/chapter08/validation.xml[]</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>There must only be one file named <em>META-INF/validation.xml</em> on the classpath. If more than one is
found an exception is thrown.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The node <code>default-provider</code> allows to choose the Jakarta Bean Validation provider. This is useful if there is
more than one provider on the classpath. <code>message-interpolator</code>, <code>traversable-resolver</code>,
<code>constraint-validator-factory</code>, <code>parameter-name-provider</code> and <code>clock-provider</code> allow to customize
the used implementations for the interfaces <code>MessageInterpolator</code>, <code>TraversableResolver</code>,
<code>ConstraintValidatorFactory</code>, <code>ParameterNameProvider</code> and <code>ClockProvider</code> defined in the
<code>jakarta.validation</code> package.
See the sub-sections of <a href="#section-configuring-validator-factory">[section-configuring-validator-factory]</a> for more information about these
interfaces.</p>
</div>
<div class="paragraph">
<p><code>value-extractor</code> allows to declare additional value extractors either to extract values from custom
container types or to override the built-in value extractors. See <a href="#chapter-valueextraction">[chapter-valueextraction]</a> for
more information about how to implement <code>jakarta.validation.valueextraction.ValueExtractor</code>.</p>
</div>
<div class="paragraph">
<p><code>executable-validation</code> and its subnodes define defaults for method validation. The Jakarta Bean Validation
specification defines constructor and non getter methods as defaults. The enabled attribute acts as
global switch to turn method validation on and off (see also <a href="#chapter-method-constraints">[chapter-method-constraints]</a>).</p>
</div>
<div class="paragraph">
<p>Via the <code>constraint-mapping</code> element you can list an arbitrary number of additional XML files
containing the actual constraint configuration. Mapping file names must be specified using their
fully-qualified name on the classpath. Details on writing mapping files can be found in the next
section.</p>
</div>
<div class="paragraph">
<p>Last but not least, you can specify provider specific properties via the <code>property</code> nodes. In the
example, we are using the Hibernate Validator specific <code>hibernate.validator.fail_fast</code> property (see
<a href="#section-fail-fast">[section-fail-fast]</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="section-mapping-xml-constraints">Mapping constraints via <code>constraint-mappings</code></h3>
<div class="paragraph">
<p>Expressing constraints in XML is possible via files adhering to the schema seen in
<a href="#image-mapping-configuration">Validation mapping schema</a>. Note that these mapping files are only processed if listed via
constraint-mapping in <em>validation.xml</em>.</p>
</div>
<div id="image-mapping-configuration" class="imageblock">
<div class="content">
<img src="validation-mapping-2.0.png" alt="validation-mapping-2.0.xsd">
</div>
<div class="title">Figure 2. Validation mapping schema</div>
</div>
<div class="paragraph">
<p><a href="#example-constraints-car">Bean constraints configured via XML</a> shows how the classes Car and RentalCar from <a href="#example-car">[example-car]</a> resp.
<a href="#example-rental-car">[example-rental-car]</a> could be mapped in XML.</p>
</div>
<div id="example-constraints-car" class="exampleblock">
<div class="title">Example 2. Bean constraints configured via XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-XML" data-lang="XML">link:{resourcesdir}/org/hibernate/validator/referenceguide/chapter08/rental-car-mapping.xml[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#example-rental-station-xml">Method constraints configured via XML</a> shows how the constraints from
<a href="#example-declaring-parameter-constraints">[example-declaring-parameter-constraints]</a>, <a href="#example-declaring-return-value-constraints">[example-declaring-return-value-constraints]</a>
and <a href="#example-specifying-constraint-target">[example-specifying-constraint-target]</a> can be expressed in XML.</p>
</div>
<div id="example-rental-station-xml" class="exampleblock">
<div class="title">Example 3. Method constraints configured via XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-XML" data-lang="XML">link:{resourcesdir}/org/hibernate/validator/referenceguide/chapter08/rental-station-mapping.xml[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The XML configuration is closely mirroring the programmatic API. For this reason it should suffice
to just add some comments. <code>default-package</code> is used for all fields where a class name is expected. If
the specified class is not fully qualified the configured default package will be used. Every
mapping file can then have several bean nodes, each describing the constraints on the entity with
the specified class name.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>A given class can only be configured once across all configuration files. The same applies for
constraint definitions for a given constraint annotation. It can only occur in one mapping file. If
these rules are violated a <code>ValidationException</code> is thrown.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Setting <code>ignore-annotations</code> to <code>true</code> means that constraint annotations placed on the configured bean
are ignored. The default for this value is true. <code>ignore-annotations</code> is also available for the nodes
<code>class</code>, <code>fields</code>, <code>getter</code>, <code>constructor</code>, <code>method</code>, <code>parameter</code>, <code>cross-parameter</code> and <code>return-value</code>.
If not explicitly specified on these levels the configured bean value applies.</p>
</div>
<div class="paragraph">
<p>The nodes <code>class</code>, <code>field</code>, <code>getter</code>, <code>container-element-type</code>, <code>constructor</code> and <code>method</code>
(and its sub node parameter) determine on which level the constraint gets placed.
The <code>valid</code> node is used to enable cascaded validation and the <code>constraint</code> node to add a constraint
on the corresponding level.
Each constraint definition must define the class via the <code>annotation</code> attribute.
The constraint attributes required by the Jakarta Bean Validation specification (<code>message</code>, <code>groups</code> and
<code>payload</code>) have dedicated nodes. All other constraint specific attributes are configured using the
<code>element</code> node.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>container-element-type</code> allows to define the cascaded validation behavior and the constraints for
container elements. In the above examples, you can see an example of nested container element
constraints on a <code>List</code> nested in the values of a <code>Map</code>. <code>type-argument-index</code> is used to precise
which type argument of the <code>Map</code> is concerned by the configuration. It can be ommitted if the
type only has one type argument (e.g. the <code>List</code>s in our examples).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>class</code> node also allows to reconfigure the default group sequence (see
<a href="#section-default-group-class">[section-default-group-class]</a>) via the <code>group-sequence</code> node. Not shown in the example is the use
of <code>convert-group</code> to
specify group conversions (see <a href="#section-group-conversion">[section-group-conversion]</a>). This node is available on <code>field</code>,
<code>getter</code>, <code>container-element-type</code>, <code>parameter</code> and <code>return-value</code> and specifies a <code>from</code> and a <code>to</code>
attributes to specify the groups.</p>
</div>
<div class="paragraph">
<p>Last but not least, the list of <code>ConstraintValidator</code> instances associated to a given constraint
can be altered via the <code>constraint-definition</code> node. The annotation attribute represents the constraint
annotation being altered. The <code>validated-by</code> element represent the (ordered) list of <code>ConstraintValidator</code>
implementations associated to the constraint. If <code>include-existing-validator</code> is set to <code>false</code>,
validators defined on the constraint annotation are ignored. If set to <code>true</code>, the list of constraint
validators described in XML is concatenated to the list of validators specified on the annotation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>One use case for constraint-definition is to change the default constraint definition for <code>@URL</code>.
Historically, Hibernate Validator&#8217;s default constraint validator for this constraint uses the
<code>java.net.URL</code> constructor to verify that an URL is valid.
However, there is also a purely regular expression based version available which can be configured using
XML:</p>
</div>
<div class="listingblock">
<div class="title">Using XML to register a regular expression based constraint definition for <code>@URL</code></div>
<div class="content">
<pre class="highlight"><code class="language-XML" data-lang="XML">&lt;constraint-definition annotation="org.hibernate.validator.constraints.URL"&gt;
  &lt;validated-by include-existing-validators="false"&gt;
    &lt;value&gt;org.hibernate.validator.constraintvalidators.RegexpURLValidator&lt;/value&gt;
  &lt;/validated-by&gt;
&lt;/constraint-definition&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-03-19 19:50:05 +0800
</div>
</div>
</body>
</html>